<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æµ·æ´‹ç‰§åœºç›‘æµ‹å¤§å±</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts @5.4.3/dist/echarts.min.js"></script>
  <script src="https://cdn.socket.io/4.0.1/socket.io.min.js "></script>
  <style>
    :root {
      --primary: #165DFF;
      --secondary: #36CFC9;
      --dark-bg: #0F172A;
      --card-bg: #1E293B;
      --text-primary: #F8FAFC;
      --text-secondary: #94A3B8;
      --border-radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      padding: 20px;
      min-height: 100vh;
    }

    .dashboard-title {
      text-align: center;
      font-size: 28px;
      margin-bottom: 30px;
      color: var(--text-primary);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .main-container {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      grid-template-rows: auto 300px auto;
      gap: 20px;
      height: calc(100vh - 100px);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(22, 93, 255, 0.2);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 18px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(22, 93, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }

    .data-value {
      font-size: 32px;
      font-weight: 700;
      margin: 10px 0;
      color: var(--text-primary);
    }

    .data-unit {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .chart-container {
      width: 100%;
      height: calc(100% - 40px);
    }

    .chart-container-small {
      height: 80px;
      margin-top: 10px;
    }

    .bottom-panel {
      grid-column: span 3;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }

    @media (max-width: 1200px) {
      .main-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto;
      }

      .bottom-panel {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1 class="dashboard-title">æµ·æ´‹ç‰§åœºç›‘æµ‹å¤§å±</h1>
  <div class="main-container">
    <!-- å·¦ä¾§æ•°æ®é¢æ¿ -->
    <div class="left-panel">
      <!-- æ°´å‹å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">æ°´å‹</span>
          <div class="card-icon">ğŸŒŠ</div>
        </div>
        <span class="data-value" id="pressureValue">--</span>
        <div class="chart-container-small" id="pressureChart"></div>
        <span class="data-unit">hPa</span>
      </div>

      <!-- æ°´æ·±å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">æ°´æ·±</span>
          <div class="card-icon">ğŸ“</div>
        </div>
        <span class="data-value" id="depthValue">--</span>
        <div class="chart-container-small" id="depthChart"></div>
        <span class="data-unit">m</span>
      </div>

      <!-- æ°´æ¸©å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">æ°´æ¸©</span>
          <div class="card-icon">ğŸŒ¡ï¸</div>
        </div>
        <span class="data-value" id="temperatureValue">--</span>
        <div class="chart-container-small" id="temperatureChart"></div>
        <span class="data-unit">Â°C</span>
      </div>
    </div>

    <!-- ä¸­é—´è½®æ’­å›¾åŒºåŸŸ -->
    <div class="center-panel">
      <!-- LSTMå›¾ç‰‡è½®æ’­ -->
      <div class="carousel-container">
        <h3 class="card-title">LSTMé¢„æµ‹ç»“æœ</h3>
        <div class="carousel" id="lstmCarousel">
          <div class="carousel-slide active"><img src="/lstm/LSTMé•¿åŠ¿é¢„æµ‹.png" alt="LSTMé•¿åŠ¿é¢„æµ‹"></div>
          <div class="carousel-slide"><img src="/lstm/å‡ºå”®ä»·æ ¼é¢„æµ‹.png" alt="å‡ºå”®ä»·æ ¼é¢„æµ‹"></div>
        </div>
        <div class="carousel-navigation">
          <div class="carousel-dot active" data-index="0"></div>
          <div class="carousel-dot" data-index="1"></div>
        </div>
      </div>

      <!-- é±¼ç—…å›¾ç‰‡è½®æ’­ -->
      <div class="carousel-container">
        <h3 class="card-title">é±¼ç—…è¯Šæ–­ç»“æœ</h3>
        <div class="carousel" id="fishDiseaseCarousel">
          <div class="carousel-slide active"><img src="/é±¼ç—…/image1.jpg" alt="é±¼ç—…å›¾ç‰‡1"></div>
          <div class="carousel-slide"><img src="/é±¼ç—…/image2.jpg" alt="é±¼ç—…å›¾ç‰‡2"></div>
          <div class="carousel-slide"><img src="/é±¼ç—…/image3.jpg" alt="é±¼ç—…å›¾ç‰‡3"></div>
        </div>
        <div class="carousel-navigation">
          <div class="carousel-dot active" data-index="0"></div>
          <div class="carousel-dot" data-index="1"></div>
          <div class="carousel-dot" data-index="2"></div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§æ•°æ®é¢æ¿ -->
    <div class="right-panel">
      <!-- é£é€Ÿå¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">é£é€Ÿ</span>
          <div class="card-icon">ğŸ’¨</div>
        </div>
        <span class="data-value" id="windSpeedValue">--</span>
        <div class="chart-container-small" id="windSpeedChart"></div>
        <span class="data-unit">m/s</span>
      </div>

      <!-- è·ç¦»å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">è·ç¦»</span>
          <div class="card-icon">ğŸ“</div>
        </div>
        <span class="data-value" id="distanceValue">--</span>
        <div class="chart-container-small" id="distanceChart"></div>
        <span class="data-unit">cm</span>
      </div>

      <!-- ç›åº¦å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">ç›åº¦</span>
          <div class="card-icon">ğŸ§‚</div>
        </div>
        <span class="data-value" id="salinityValue">--</span>
        <div class="chart-container-small" id="salinityChart"></div>
        <span class="data-unit">â€°</span>
      </div>
    </div>

    <!-- åº•éƒ¨å›¾è¡¨åŒºåŸŸ -->
    <div class="bottom-panel">
      <!-- PHæŠ˜çº¿å›¾ -->
      <div class="chart-card">
        <div class="card-header">
          <span class="card-title">PHå€¼å˜åŒ–</span>
        </div>
        <div class="chart-container" id="phChart"></div>
      </div>

      <!-- æ¸”åŒºå æ¯”é¥¼å›¾ -->
      <div class="chart-card">
        <div class="card-header">
          <span class="card-title">æ¸”åŒºå æ¯”</span>
        </div>
        <div class="chart-container" id="fishingAreaChart"></div>
      </div>

      <!-- æ‚£ç—…é±¼æ¯”ä¾‹é¥¼å›¾ -->
      <div class="chart-card">
        <div class="card-header">
          <span class="card-title">æ‚£ç—…é±¼æ¯”ä¾‹</span>
        </div>
        <div class="chart-container" id="fishHealthChart"></div>
      </div>

      <!-- é£é€ŸæŠ˜çº¿å›¾ -->
      <div class="chart-card">
        <div class="card-header">
          <span class="card-title">é£é€Ÿè¶‹åŠ¿</span>
        </div>
        <div class="chart-container" id="windSpeedChartBottom"></div>
      </div>
    </div>
  </div>

  <script>
    // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
    const charts = {
      pressure: echarts.init(document.getElementById('pressureChart')),
      depth: echarts.init(document.getElementById('depthChart')),
      temperature: echarts.init(document.getElementById('temperatureChart')),
      wind_speed: echarts.init(document.getElementById('windSpeedChart')),
      salinity: echarts.init(document.getElementById('salinityChart')),
      distance: echarts.init(document.getElementById('distanceChart')),
      ph: echarts.init(document.getElementById('phChart')),
      fishingArea: echarts.init(document.getElementById('fishingAreaChart')),
      fishHealth: echarts.init(document.getElementById('fishHealthChart')),
      windSpeedBottom: echarts.init(document.getElementById('windSpeedChartBottom'))
    };

    // å›¾è¡¨ä¸»é¢˜æ ·å¼
    const chartTheme = {
      backgroundColor: 'transparent',
      textStyle: { color: '#F8FAFC' },
      title: { textStyle: { color: '#94A3B8' } },
      tooltip: {
        backgroundColor: 'rgba(30, 41, 59, 0.8)',
        borderColor: '#165DFF',
        textStyle: { color: '#F8FAFC' }
      },
      legend: { show: false },
      grid: { borderColor: 'transparent' },
      xAxis: { show: false },
      yAxis: { show: false }
    };

    // é£é€ŸæŠ˜çº¿å›¾é…ç½®
    const windSpeedOption = {
      ...chartTheme,
      tooltip: { trigger: 'axis' },
      series: [{ data: [], type: 'line', smooth: true, itemStyle: { color: '#165DFF' }, lineStyle: { width: 2 } }]
    };

    // PHå€¼æŠ˜çº¿å›¾é…ç½®
    const phOption = {
      ...chartTheme,
      tooltip: { trigger: 'axis' },
      series: [{
        data: [],
        type: 'line',
        smooth: true,
        itemStyle: {
          color: params => params.value > 7 ? '#FBBF24' : '#EF4444'
        },
        lineStyle: { width: 2 }
      }]
    };

    // åˆå§‹åŒ–å›¾è¡¨é…ç½®
    ['pressure', 'depth', 'temperature', 'wind_speed', 'salinity', 'distance'].forEach(key => {
      if (charts[key]) {
        charts[key].setOption(getLineChartOption());
      }
    });

    function getLineChartOption() {
      return {
        grid: { top: 10, right: 10, left: 0, bottom: 20 },
        tooltip: { type: 'line', trigger: 'axis' },
        xAxis: { type: 'category', show: false },
        yAxis: { type: 'value', boundaryGap: [0, '30%'], splitLine: { lineStyle: { color: '#334155' } } },
        series: [{
          data: [],
          type: 'line',
          smooth: true,
          symbol: 'none',
          areaStyle: {
            color: {
              type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
              colorStops: [
                { offset: 0, color: 'rgba(59, 130, 246, 0.4)' },
                { offset: 1, color: 'rgba(59, 130, 246, 0)' }
              ]
            }
          },
          lineStyle: { color: 'rgba(59, 130, 246, 1)', width: 2 }
        }]
      };
    }

    // æ›´æ–°ä¼ æ„Ÿå™¨æ•°æ®æ˜¾ç¤º
    function updateValues(data) {
      const elements = {
        pressure: 'pressureValue',
        depth: 'depthValue',
        temperature: 'temperatureValue',
        wind_speed: 'windSpeedValue',
        salinity: 'salinityValue',
        ph: 'ph',
        distance: 'distanceValue'
      };

      for (const [key, id] of Object.entries(elements)) {
        const element = document.getElementById(id);
        if (element) {
          let value = data[key];
          if (value === undefined && data.history?.[key]?.length > 0) {
            value = data.history[key][data.history[key].length - 1];
          }
          if (value !== undefined) {
            element.textContent = value.toFixed(1);
          }
        }
      }

      // æ›´æ–°å›¾è¡¨
      if (data.history?.wind_speed?.length > 0) {
        const latestWindSpeed = data.history.wind_speed[data.history.wind_speed.length - 1];
        const timeStr = new Date().toLocaleTimeString();
        if (windSpeedOption.xAxis.data.length > 20) {
          windSpeedOption.xAxis.data.shift();
          windSpeedOption.series[0].data.shift();
        }
        windSpeedOption.xAxis.data.push(timeStr);
        windSpeedOption.series[0].data.push(latestWindSpeed);
        charts.wind_speed.setOption(windSpeedOption);
      }

      if (data.history?.ph?.length > 0) {
        const latestPh = data.history.ph[data.history.ph.length - 1];
        const timeStr = new Date().toLocaleTimeString();
        if (phOption.xAxis.data.length > 20) {
          phOption.xAxis.data.shift();
          phOption.series[0].data.shift();
        }
        phOption.xAxis.data.push(timeStr);
        phOption.series[0].data.push(latestPh);
        charts.ph.setOption(phOption);
      }
    }

    // è¿æ¥SocketIOæœåŠ¡å™¨
    const socket = io();
    socket.on('initial_data', (data) => {
      console.log('åˆå§‹æ•°æ®:', data);
      updateValues(data);
    });

    socket.on('sensor_update', function (data) {
      console.log('æ¥æ”¶åˆ°æ•°æ®æ›´æ–°:', data);
      updateValues(data);
    });

    // å›¾ç‰‡è½®æ’­åŠŸèƒ½ï¼ˆç•¥ï¼Œå¯å‚è€ƒåŸé€»è¾‘ï¼‰
  </script>
</body>
</html>